<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Category Fund Summary</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link rel="icon" href="/static/UPC.png">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script defer src="/static/category-summary.js"></script>


</head>

<body>
    <nav class="navbar">
        <div class="nav-left">
            <span class="navbar-brand">EMPIRE</span>
        </div>
        <div class="nav-right">
            <button id="open-calculator" title="Open Calculator" class="navbar-calc-btn"
                style="background:#222; color:#f1c40f; border:none; border-radius:50%; width:40px; height:40px; font-size:1.5rem; box-shadow:0 2px 8px #0001; cursor:pointer; display:inline-flex; align-items:center; justify-content:center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="4" fill="#f1c40f" />
                    <rect x="7" y="7" width="10" height="3" rx="1" fill="#222" />
                    <rect x="7" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="11" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="15" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="7" y="16" width="3" height="3" rx="1" fill="#222" />
                    <rect x="11" y="16" width="3" height="3" rx="1" fill="#222" />
                    <rect x="15" y="16" width="3" height="3" rx="1" fill="#222" />
                </svg>
            </button>
            <!-- Burger for mobile -->
            <input type="checkbox" id="nav-toggle" class="nav-toggle" />
            <label for="nav-toggle" class="nav-toggle-label">
                <span></span>
                <span></span>
                <span></span>
            </label>
            <ul class="navbar-links">
                <li><a href="/">Entries</a></li>
                <li><a href="/category-summary" class="active">Fund Categories</a></li>
                <li><a href="/logout" style="color: #e74c3c;"><b>Logout</b></a></li>
            </ul>
        </div>
    </nav>

    <main>
        <div class="partition">
            <button id="scroll-calculator-btn" title="Open Calculator" class="navbar-calc-btn" style="
                background:#222;
                color:#f1c40f;
                border:none;
                border-radius:50%;
                width:40px;
                height:40px;
                font-size:1.5rem;
                box-shadow:0 2px 8px #0001;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
                position:fixed;   /* Make it float */
                top: 20px;        /* Top-right corner */
                right: 20px;
                z-index: 9999;">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="none" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="4" fill="#f1c40f" />
                    <rect x="7" y="7" width="10" height="3" rx="1" fill="#222" />
                    <rect x="7" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="11" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="15" y="12" width="3" height="3" rx="1" fill="#222" />
                    <rect x="7" y="16" width="3" height="3" rx="1" fill="#222" />
                    <rect x="11" y="16" width="3" height="3" rx="1" fill="#222" />
                    <rect x="15" y="16" width="3" height="3" rx="1" fill="#222" />
                </svg>
            </button>

            <!-- Floating Search Button -->
            <button id="scroll-search-btn" title="Search Person" class="navbar-calc-btn" style="
                background:#2980b9;
                color:white;
                border:none;
                border-radius:50%;
                width:40px;
                height:40px;
                font-size:1.5rem;
                box-shadow:0 2px 8px #0001;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
                position:fixed;   /* Make it float */
                top: 70px;        /* Below calculator */
                right: 20px;
                z-index: 9999;">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </button>

            <!-- Floating Log Button (below search) -->
            <button id="scroll-log-btn" title="View Log" class="navbar-calc-btn" style="
                background:#27ae60;
                color:white;
                border:none;
                border-radius:50%;
                width:40px;
                height:40px;
                font-size:1.5rem;
                box-shadow:0 2px 8px #0001;
                cursor:pointer;
                display:flex;
                align-items:center;
                justify-content:center;
                position:fixed;
                top: 120px;
                right: 20px;
                z-index: 9999;">
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="16" y1="13" x2="8" y2="13"></line>
                    <line x1="16" y1="17" x2="8" y2="17"></line>
                    <polyline points="10 9 9 9 8 9"></polyline>
                </svg>
            </button>


            <h4>Givings Per Person (Monthly)</h4> <br>

            <label for="category-select">Category:</label>
            <select id="category-select">
                {% if username == 'admin' %}
                <option value="tithes">Tithes</option>
                <option value="offering">Offering</option>
                <option value="fp">FP</option>
                <option value="hor">HOR</option>
                <option value="sundayschool">Sunday School</option>
                <option value="for_visitor">For Visitor(bigas)</option>
                <option value="soc">SOC</option>
                <option value="sfc">SFC</option>
                <option value="ph">PH</option>
                <option value="amd">AMD</option>
                <option value="crv">CRV</option>
                <option value="others">Others</option>
                <option value="tithes(tithes)">Tithes (Tithes)</option>
                <option value="church tithes">Church Tithes</option>
                <option value="fp(tithes)">FP (Tithes)</option>
                <option value="hor(tithes)">HOR (Tithes)</option>
                <option value="sundayschool(tithes)">Sunday School (Tithes)</option>
                <option value="fp(hq)">FP (HQ)</option>
                <option value="hor(hq)">HOR (HQ)</option>

                {% else %}
                <option value="offering">Offering</option>
                <option value="fp">FP</option>
                <option value="hor">HOR</option>
                <option value="soc">SOC</option>
                <option value="sundayschool">Sunday School</option>
                <option value="for_visitor">For Visitor(bigas)</option>
                <option value="others">Others</option>
                {% endif %}
            </select>
            <br>
            <br>
            <div style="margin-bottom: 20px;">
                <label>Month:</label>
                <div style="display: inline-flex; gap: 10px;">
                    <select id="month-select" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>

                    <select id="year-select" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
                        <!-- Will be populated by JS -->
                    </select>
                </div>
            </div>

            <div class="table-wrapper">
                <table id="givings-table">
                    <thead>
                        <tr id="givings-header"></tr>
                    </thead>
                    <tbody id="givings-body"></tbody>
                </table>
            </div>
            <br>
            <button id="print-table-btn">Print Table</button>

            <!-- Modal Structure -->
            <div id="print-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
     background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
                <div style="background:white; padding:20px; border-radius:8px; width:300px; text-align:center;">
                    <h3>Select Month Range</h3>
                    <div style="margin-bottom: 15px;">
                        <label>Start Month:</label>
                        <div style="display: flex; gap: 5px; justify-content: center;">
                            <select id="modal-start-month-select" style="padding: 5px;">
                                <option value="01">January</option>
                                <option value="02">February</option>
                                <option value="03">March</option>
                                <option value="04">April</option>
                                <option value="05">May</option>
                                <option value="06">June</option>
                                <option value="07">July</option>
                                <option value="08">August</option>
                                <option value="09">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                            <select id="modal-start-year-select" style="padding: 5px;"></select>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label>End Month (optional):</label>
                        <div style="display: flex; gap: 5px; justify-content: center;">
                            <select id="modal-end-month-select" style="padding: 5px;">
                                <option value="">-- Month --</option>
                                <option value="01">January</option>
                                <option value="02">February</option>
                                <option value="03">March</option>
                                <option value="04">April</option>
                                <option value="05">May</option>
                                <option value="06">June</option>
                                <option value="07">July</option>
                                <option value="08">August</option>
                                <option value="09">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                            <select id="modal-end-year-select" style="padding: 5px;">
                                <option value="">-- Year --</option>
                            </select>
                        </div>
                    </div>
                    <button id="modal-print-btn">Print</button>
                    <button id="modal-cancel-btn" style="margin-left:10px; background-color: #a83022;">Cancel</button>
                </div>
            </div>

            <div id="info-box" style="
            position:absolute;
            display:none;
            background:#333;
            color:white;
            padding:8px;
            border-radius:4px;
            font-size:0.9rem;
            z-index:9999;
        "></div>

            <!-- <br><br><br><br>
            <hr>
            <br><br><br><br> -->

            <!-- <h3>Church Fund Category Summary</h3>

            <h4 id="category-title">Tithes</h4>
            <h5 id="cash-on-hand" style="margin-bottom: 16px; font-size: 1.5rem;">Cash on Hand: â‚±0.00</h5>

            <div class="table-wrapper">
                <table id="category-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Amount</th>
                            <th>Label</th>
                            <th>Total Expenses</th>
                            <th>Remaining</th>
                            <th>Action</th>

                        </tr>
                    </thead>

                    <tbody id="category-table-body">
                        
                    </tbody>
                </table>
            </div> -->

            <div class="modal-overlay" id="expense-modal" style="display:none;">
                <div class="modal-content">
                    <span class="modal-close" id="close-expense-modal">&times;</span>
                    <h3>Add Expense for <span id="modal-category-name">Category</span></h3>
                    <form id="expense-form">
                        <!-- ðŸ”§ Fix: Add this hidden input for expense ID -->
                        <input type="hidden" id="modal-expense-id">

                        <input type="hidden" id="expense-date" name="date">

                        <label for="expense-amount">Amount:</label>
                        <input type="number" id="expense-amount" step="0.01" required>

                        <label for="expense-label">Label:</label>
                        <input type="text" id="expense-label" required>

                        <label for="modal-category-select">Category:</label>
                        <select id="modal-category-select" required></select>

                        <button type="submit">Submit Expense</button>
                    </form>
                </div>
            </div>

            {% if is_admin %}
            <button id="add-expense-btn"
                style="padding: 8px 16px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">
                + Add Expense
            </button>
            {% else %}
            <!-- Hidden for non-admin -->
            {% endif %}



            <!-- Calculator Modal -->
            <div id="calculator-modal" class="modal-overlay" style="display:none;">
                <div class="calculator-modal-content">
                    <span class="modal-close" id="close-calculator-modal">&times;</span>
                    <div class="calculator-modern">
                        <div id="calc-history" class="calc-history"></div>
                        <input type="text" id="calc-display" class="calc-display" value="0" readonly />
                        <div class="calc-buttons">
                            <button class="calc-btn" data-action="clear">C</button>
                            <button class="calc-btn" data-action="back">&larr;</button>
                            <button class="calc-btn" data-action="/">&#247;</button>
                            <button class="calc-btn" data-action="*">&times;</button>
                            <button class="calc-btn" data-action="7">7</button>
                            <button class="calc-btn" data-action="8">8</button>
                            <button class="calc-btn" data-action="9">9</button>
                            <button class="calc-btn" data-action="-">-</button>
                            <button class="calc-btn" data-action="4">4</button>
                            <button class="calc-btn" data-action="5">5</button>
                            <button class="calc-btn" data-action="6">6</button>
                            <button class="calc-btn" data-action="+">+</button>
                            <button class="calc-btn" data-action="1">1</button>
                            <button class="calc-btn" data-action="2">2</button>
                            <button class="calc-btn" data-action="3">3</button>
                            <button class="calc-btn equal-btn" data-action="=">=</button>
                            <button class="calc-btn zero-btn" data-action="0">0</button>
                            <button class="calc-btn" data-action=".">.</button>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Search Modal -->
            <div id="search-modal" class="modal-overlay"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:2000; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
                <div class="modal-content"
                    style="background:white; width:90%; max-width:800px; max-height:90vh; overflow-y:auto; padding:20px; border-radius:8px;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <h3>Search Person Givings</h3>
                        <span id="close-search-modal" style="font-size:2rem; cursor:pointer;">&times;</span>
                    </div>

                    <div class="search-controls"
                        style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; align-items: center;">
                        <div style="position:relative;">
                            <input type="text" id="search-name-input" list="name-suggestions" placeholder="Enter Name"
                                autocomplete="off"
                                style="padding: 8px; border:1px solid #ccc; border-radius:4px; width: 200px;">
                            <datalist id="name-suggestions"></datalist>
                        </div>

                        <select id="search-filter-type" style="padding: 8px; border:1px solid #ccc; border-radius:4px;">
                            <option value="year">By Year</option>
                            <option value="month">By Month</option>
                            <option value="date">Specific Date</option>
                            <option value="category">By Category</option>
                        </select>

                        <!-- Filter Inputs (Visibility toggled by JS) -->
                        <div id="filter-year-container">
                            <select id="search-year-select"
                                style="padding: 8px; border:1px solid #ccc; border-radius:4px;">
                                <option value="">All Years</option>
                            </select>
                        </div>

                        <div id="filter-month-container" style="display:none;">
                            <select id="search-month-select"
                                style="padding: 8px; border:1px solid #ccc; border-radius:4px;">
                                <option value="01">January</option>
                                <option value="02">February</option>
                                <option value="03">March</option>
                                <option value="04">April</option>
                                <option value="05">May</option>
                                <option value="06">June</option>
                                <option value="07">July</option>
                                <option value="08">August</option>
                                <option value="09">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                        </div>

                        <div id="filter-date-container" style="display:none;">
                            <input type="date" id="search-date-input"
                                style="padding: 8px; border:1px solid #ccc; border-radius:4px;">
                        </div>

                        <div id="filter-category-container" style="display:none;">
                            <select id="search-category-select"
                                style="padding: 8px; border:1px solid #ccc; border-radius:4px;">
                                <option value="">All Categories</option>
                                <option value="tithes">Tithes</option>
                                <option value="offering">Offering</option>
                                <option value="sfc">SFC</option>
                                <option value="fp">FP</option>
                                <option value="ph">PH</option>
                                <option value="hor">HOR</option>
                                <option value="soc">SOC</option>
                                <option value="sundayschool">Sunday School</option>
                                <option value="for_visitor">For Visitor (bigas)</option>
                                <option value="amd">AMD</option>
                                <option value="others">Others</option>
                            </select>
                        </div>

                    </div>

                    <div id="search-total-summary"
                        style="margin-bottom: 10px; font-weight: bold; font-size:1.1rem; color:#2c3e50;"></div>

                    <div class="table-wrapper" style="max-height: 500px; overflow-y: auto;">
                        <table id="search-results-table" style="width:100%; border-collapse: collapse;">
                            <thead style="position: sticky; top: 0; z-index: 10;">
                                <tr style="background:#2c3e50;">
                                    <th
                                        style="padding:12px; border:1px solid #34495e; text-align:left; color:white; font-weight:600; font-size:0.95rem;">
                                        Date</th>
                                    <th
                                        style="padding:12px; border:1px solid #34495e; text-align:left; color:white; font-weight:600; font-size:0.95rem;">
                                        Name</th>
                                    <th
                                        style="padding:12px; border:1px solid #34495e; text-align:left; color:white; font-weight:600; font-size:0.95rem;">
                                        Category</th>
                                    <th
                                        style="padding:12px; border:1px solid #34495e; text-align:right; color:white; font-weight:600; font-size:0.95rem;">
                                        Amount</th>
                                </tr>
                            </thead>
                            <tbody id="search-results-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Log Modal (Dates with input + Actions) -->
            <div id="log-modal" class="modal-overlay"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; z-index:2000; background:rgba(0,0,0,0.5); justify-content:center; align-items:center;">
                <div class="modal-content"
                    style="background:white; width:90%; max-width:700px; max-height:90vh; overflow:hidden; padding:0; border-radius:8px; display:flex; flex-direction:column;">
                    <div
                        style="display:flex; justify-content:space-between; align-items:center; padding:16px 20px; border-bottom:1px solid #eee;">
                        <h3 style="margin:0;">Log</h3>
                        <span id="close-log-modal" style="font-size:2rem; cursor:pointer; line-height:1;">&times;</span>
                    </div>
                    <div style="display:flex; border-bottom:1px solid #444;">
                        <button type="button" id="log-tab-dates" class="log-tab active"
                            style="flex:1; padding:12px; border:none; background:#5d6d7e; color:#fff; cursor:pointer; font-weight:600;">
                            Dates with input
                        </button>
                        <button type="button" id="log-tab-actions" class="log-tab"
                            style="flex:1; padding:12px; border:none; background:#4a5568; color:#fff; cursor:pointer;">
                            Actions
                        </button>
                    </div>
                    <div id="log-content" style="flex:1; overflow-y:auto; padding:20px;">
                        <!-- Tab 1: Dates with input -->
                        <div id="log-panel-dates" class="log-panel">
                            <p style="color:#666; margin-bottom:10px;">All dates that have entries or expenses.</p>
                            <ul id="log-dates-list"
                                style="list-style:none; padding:0; margin:0; max-height:400px; overflow-y:auto;"></ul>
                            <p id="log-dates-empty" style="display:none; color:#999;">No dates with input.</p>
                        </div>
                        <!-- Tab 2: Actions -->
                        <div id="log-panel-actions" class="log-panel" style="display:none;">
                            <p style="color:#666; margin-bottom:10px;">Add, update, and delete actions with date,
                                category, and who did it.</p>
                            <div class="table-wrapper" style="max-height:400px; overflow-y:auto;">
                                <table style="width:100%; border-collapse:collapse;">
                                    <thead style="position:sticky; top:0; background:#1a252f;">
                                        <tr>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:left;">
                                                When</th>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:left;">
                                                Action</th>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:left;">
                                                Name</th>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:left;">
                                                Category</th>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:right;">
                                                Amount</th>
                                            <th
                                                style="padding:10px; border:1px solid #0d1117; color:white; text-align:left;">
                                                Recorded By</th>
                                        </tr>
                                    </thead>
                                    <tbody id="log-actions-body"></tbody>
                                </table>
                            </div>
                            <p id="log-actions-empty" style="display:none; color:#999;">No actions recorded.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>
</body>

</html>